<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>靈數能量與水晶連線</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@300;400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: {
                            DEFAULT: '#967740',
                            light: '#bca065',
                            dark: '#755c32',
                            warm: '#FDFCF8',
                            soft: '#F4EFE6'
                        }
                    },
                    fontFamily: {
                        serif: ['"Noto Serif TC"', 'serif'],
                        sans: ['"Lato"', 'sans-serif'],
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #FDFCF8;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(150, 119, 64, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(150, 119, 64, 0.05) 0%, transparent 20%);
            font-family: 'Noto Serif TC', serif;
            color: #5D5D5D;
            -webkit-font-smoothing: antialiased;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 40px rgba(150, 119, 64, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .special-card {
            background: linear-gradient(145deg, #2c241b 0%, #4a3b2a 100%);
            color: #eaddcf;
            border: 1px solid #967740;
            position: relative;
            overflow: hidden;
        }
        .special-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(150, 119, 64, 0.3) 0%, transparent 60%);
            animation: pulse-slow 6s infinite;
        }
        .crystal-btn {
            background: #967740;
            color: white;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .crystal-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: 0.5s;
        }
        .crystal-btn:hover::after {
            left: 100%;
        }
        .crystal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(150, 119, 64, 0.25);
        }
        .tag-pill {
            font-family: 'Lato', sans-serif;
            font-size: 0.75rem;
            padding: 4px 12px;
            border-radius: 999px;
            background: #fff;
            border: 1px solid #E5E5E5;
            color: #666;
            display: inline-block;
            margin: 3px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .tag-pill:hover {
            border-color: #967740;
            color: #967740;
        }
        input[type="date"], input[type="text"], select {
            position: relative;
            padding: 12px;
            background: rgba(255,255,255,0.8);
            border: 1px solid #E0D6C2;
            color: #5D5D5D;
            font-family: 'Lato', sans-serif;
            letter-spacing: 1px;
            cursor: pointer;
            width: 100%;
            outline: none;
            transition: border-color 0.3s;
            appearance: none;
            -webkit-appearance: none;
        }
        select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23967740' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
        input[type="text"]:focus, select:focus {
            border-color: #967740;
            ring: 1px solid #967740;
        }
        
        .quote-card {
            background: linear-gradient(135deg, #fffcf5 0%, #fff 100%);
            border: 1px solid #f0e6d2;
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .quote-card::before {
            content: '"';
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 60px;
            color: #967740;
            opacity: 0.1;
            font-family: serif;
            line-height: 1;
        }
        
        /* Master Number Badge */
        .master-badge {
            background: linear-gradient(135deg, #967740 0%, #bca065 100%);
            color: white;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(150, 119, 64, 0.3);
        }
        
        /* Utility for animation delay */
        .delay-100 { animation-delay: 100ms; }
        .delay-200 { animation-delay: 200ms; }
        .delay-300 { animation-delay: 300ms; }
        .delay-400 { animation-delay: 400ms; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-6 px-4 md:py-12 md:px-8">

    <!-- Crystal Decoration Background -->
    <div class="fixed top-10 left-10 w-32 h-32 md:w-64 md:h-64 bg-gold opacity-5 rounded-full blur-3xl pointer-events-none"></div>
    <div class="fixed bottom-10 right-10 w-48 h-48 md:w-80 md:h-80 bg-gold opacity-5 rounded-full blur-3xl pointer-events-none"></div>

    <!-- Main Container -->
    <div class="w-full max-w-md md:max-w-2xl lg:max-w-4xl relative z-10">
        
        <!-- Header -->
        <header class="text-center mb-8 md:mb-12 animate-fade-in-up delay-100">
            <div class="inline-block p-4 mb-4 rounded-full border border-gold/30 bg-white/50 animate-float">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-gold">
                    <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <h1 class="text-3xl md:text-4xl font-serif font-medium text-gray-800 tracking-widest mb-2">靈數與水晶</h1>
            <p class="text-gold text-xs md:text-sm uppercase tracking-[0.3em] font-sans">Numerology & Crystal Energy</p>
        </header>

        <!-- Input Card (Dropdown Version for Tablet) -->
        <div class="glass-card rounded-3xl p-8 mb-8 animate-fade-in-up delay-200 mx-auto max-w-lg">
            <div class="flex flex-col gap-4">
                <label class="text-xs font-bold text-gray-400 uppercase tracking-widest pl-1 text-center md:text-left">Select Your Birth Date</label>
                
                <div class="flex gap-2">
                    <!-- Year -->
                    <div class="relative w-1/3">
                        <select id="birthYear" class="w-full rounded-xl border border-gold/30 bg-white/50 px-3 py-3 text-lg text-gray-700 focus:border-gold focus:ring-1 focus:ring-gold text-center">
                            <option value="" disabled selected>年 Year</option>
                            <!-- JS populates -->
                        </select>
                    </div>
                    <!-- Month -->
                    <div class="relative w-1/3">
                        <select id="birthMonth" class="w-full rounded-xl border border-gold/30 bg-white/50 px-3 py-3 text-lg text-gray-700 focus:border-gold focus:ring-1 focus:ring-gold text-center">
                            <option value="" disabled selected>月 Month</option>
                            <!-- JS populates -->
                        </select>
                    </div>
                    <!-- Day -->
                    <div class="relative w-1/3">
                        <select id="birthDay" class="w-full rounded-xl border border-gold/30 bg-white/50 px-3 py-3 text-lg text-gray-700 focus:border-gold focus:ring-1 focus:ring-gold text-center">
                            <option value="" disabled selected>日 Day</option>
                            <!-- JS populates -->
                        </select>
                    </div>
                </div>

                <button onclick="calculate()" class="crystal-btn w-full py-4 rounded-xl font-medium tracking-widest text-sm uppercase mt-4 shadow-lg h-14 flex items-center justify-center gap-2">
                    <span>開啟能量指引</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg>
                </button>
            </div>
        </div>

        <!-- Result Container -->
        <div id="resultSection" class="hidden flex flex-col gap-6 md:gap-8 pb-12">

            <!-- 1. Life Path (Full Width) -->
            <div class="glass-card rounded-3xl p-8 md:p-10 text-center animate-fade-in-up relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-gold to-transparent opacity-50"></div>
                <span class="text-xs text-gold uppercase tracking-widest border border-gold px-4 py-1.5 rounded-full inline-block mb-6">Life Path Number</span>
                
                <div class="flex flex-col md:flex-row items-center justify-center gap-6 md:gap-12">
                    <div class="shrink-0 text-center">
                        <span class="text-6xl md:text-8xl font-serif text-gray-800 leading-none" id="lifePathNum">?</span>
                        <div id="masterTag" class="hidden mt-2">
                            <span class="master-badge">Master Number</span>
                        </div>
                    </div>
                    <div class="text-left max-w-lg">
                        <h2 class="text-xl md:text-2xl font-bold text-gray-700 mb-3 text-center md:text-left" id="lifePathTitle"></h2>
                        <p class="text-sm md:text-base text-gray-600 leading-relaxed font-light text-justify" id="lifePathDesc"></p>
                    </div>
                </div>
            </div>

            <!-- 2. Missing Numbers & Connections (Grid on Tablet+) -->
            <div class="glass-card rounded-3xl p-6 md:p-10 animate-fade-in-up delay-100">
                <div class="flex items-center gap-3 mb-6 pb-4 border-b border-gray-100">
                    <div class="w-8 h-8 rounded-full bg-gold/10 flex items-center justify-center text-gold shrink-0">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
                    </div>
                    <h3 class="text-lg md:text-xl font-serif text-gray-800 font-bold">能量空缺與連線效應</h3>
                </div>

                <!-- NEW: Special Crystal Recommendations -->
                <div id="specialSection" class="hidden mb-8">
                    <div class="special-card rounded-2xl p-6 shadow-xl transform hover:-translate-y-1 transition-transform duration-500 relative z-0">
                        <div class="relative z-10">
                            <div class="flex items-center justify-between mb-4 border-b border-[#967740]/50 pb-3">
                                <h4 class="text-lg font-bold text-[#bca065] flex items-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3v18l15-9-15-9z"/></svg>
                                    店長私藏・高階全能補給
                                </h4>
                                <span class="text-[10px] uppercase tracking-widest bg-[#967740] text-white px-2 py-1 rounded">Special Edition</span>
                            </div>
                            <p class="text-sm text-gray-300 mb-4 font-light">
                                根據您的空缺數組合，為您隨機精選以下 <span class="text-[#bca065] font-bold">最多6款</span> 高頻能量水晶，一次補足多重能量。
                            </p>
                            <div id="specialContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Dynamic Special Crystals -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Missing Container -->
                <div id="missingContainer" class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <!-- Dynamic Content -->
                </div>

                <div id="noMissing" class="hidden p-8 text-center bg-gold/5 rounded-2xl border border-gold/10">
                    <p class="text-gold font-medium text-lg">您的能量非常圓滿</p>
                    <p class="text-sm text-gray-500 mt-2">您的命盤沒有空缺數，建議佩戴「白水晶」或「阿賽斯特萊」來放大既有優勢並提升頻率。</p>
                </div>
            </div>

            <!-- 3. Flow Month & Daily Quote -->
            <div class="glass-card rounded-3xl p-6 md:p-10 animate-fade-in-up delay-200 relative">
                <div class="absolute -right-4 -top-4 text-9xl text-gold opacity-[0.03] font-serif pointer-events-none select-none hidden md:block">Time</div>
                
                <!-- Flow Header -->
                <div class="flex justify-between items-end mb-6 md:mb-8">
                    <div>
                        <p class="text-xs text-gray-400 uppercase tracking-widest mb-1">Current Energy</p>
                        <h3 class="text-xl md:text-2xl font-serif text-gray-800">流月 <span id="flowMonthNum" class="text-gold text-3xl ml-1 font-bold">?</span> 運勢</h3>
                    </div>
                    <div class="text-right">
                        <p id="currentDateDisplay" class="text-xs md:text-sm font-sans text-gray-400 font-medium bg-gray-50 px-3 py-1 rounded-lg"></p>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="flex flex-col lg:flex-row gap-6">
                    
                    <!-- Monthly Content -->
                    <div class="flex-1 bg-gradient-to-br from-[#FDFCF8] to-[#F7F3EA] p-5 md:p-6 rounded-2xl border border-white shadow-inner flex flex-col">
                        <div class="mb-4">
                            <span class="text-xs font-bold text-gold uppercase tracking-wider block mb-3">Monthly Crystals</span>
                            <div id="flowCrystal" class="flex flex-wrap gap-2"></div>
                        </div>
                        <p id="flowDesc" class="text-sm md:text-base text-gray-600 font-light leading-relaxed text-justify mt-auto pt-4 border-t border-gray-200/50"></p>
                    </div>

                    <!-- Daily Quote -->
                    <div class="lg:w-2/5">
                        <div class="quote-card rounded-xl p-6 shadow-sm h-full">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-[10px] tracking-[0.2em] uppercase text-gold font-bold bg-gold/10 px-2 py-1 rounded">Daily Insight</span>
                                <span class="text-xs text-gray-400">流日 <span id="flowDayNum" class="font-bold text-gray-600 text-lg mx-1">?</span></span>
                            </div>
                            <p id="dailyQuoteText" class="text-base md:text-lg font-serif text-gray-700 leading-relaxed font-medium text-center italic my-2"></p>
                            <div class="text-center mt-4">
                                <div class="w-8 h-0.5 bg-gold/30 mx-auto rounded-full"></div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="text-center mt-4 mb-12">
                <button onclick="resetApp()" class="text-gray-400 hover:text-gold text-xs uppercase tracking-widest py-4 transition-colors border-b border-transparent hover:border-gold">
                    重新計算 Reset
                </button>
            </div>
            
             <!-- 4. Crystal Energy Lookup Section -->
            <div class="glass-card rounded-3xl p-6 md:p-8 animate-fade-in-up delay-300 w-full mb-12">
                 <div class="flex items-center justify-center gap-2 mb-6">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#967740" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <h3 class="text-lg font-bold text-gray-800">水晶能量速查</h3>
                </div>
                
                <div class="max-w-lg mx-auto">
                    <div class="relative mb-6">
                        <input type="text" id="crystalSearchInput" onkeyup="searchCrystal()" placeholder="輸入水晶名稱 (如: 白水晶、紅膠花...)" class="w-full rounded-xl border border-gray-200 bg-white/50 px-4 py-3 focus:border-gold focus:ring-1 focus:ring-gold text-center text-gray-700 placeholder-gray-400">
                    </div>
                    
                    <div id="crystalSearchResult" class="hidden space-y-4">
                        <!-- Dynamic Results -->
                    </div>
                </div>
            </div>

        </div>
    </div>

    <script>
        // --- 初始化下拉選單 ---
        window.onload = function() {
            const yearSelect = document.getElementById('birthYear');
            const monthSelect = document.getElementById('birthMonth');
            const daySelect = document.getElementById('birthDay');
            const currentYear = new Date().getFullYear();

            // Populate Years (Current back to 1920)
            for (let y = currentYear; y >= 1920; y--) {
                let opt = document.createElement('option');
                opt.value = y;
                opt.innerText = y;
                yearSelect.appendChild(opt);
            }

            // Populate Months (1-12)
            for (let m = 1; m <= 12; m++) {
                let opt = document.createElement('option');
                opt.value = m;
                opt.innerText = m + '月';
                monthSelect.appendChild(opt);
            }

            // Populate Days initially (1-31)
            updateDays();

            // Event Listeners for dynamic day updates
            yearSelect.addEventListener('change', updateDays);
            monthSelect.addEventListener('change', updateDays);
        };

        function updateDays() {
            const year = parseInt(document.getElementById('birthYear').value) || 2000; // Default year for leap check
            const month = parseInt(document.getElementById('birthMonth').value) || 1;
            const daySelect = document.getElementById('birthDay');
            const currentSelection = parseInt(daySelect.value);

            // Get number of days in the selected month
            const daysInMonth = new Date(year, month, 0).getDate();

            // Clear current options
            daySelect.innerHTML = '<option value="" disabled selected>日 Day</option>';

            for (let d = 1; d <= daysInMonth; d++) {
                let opt = document.createElement('option');
                opt.value = d;
                opt.innerText = d;
                if (d === currentSelection) {
                    opt.selected = true;
                }
                daySelect.appendChild(opt);
            }
        }

        // --- 1. 生命靈數主修數 & 大師數 ---
        const lifePathData = {
            1: { title: "開創者 (The Leader)", desc: "您擁有強大的獨立性與開創精神，適合擔任決策者。但需注意「固執」與「堅持」的區別，學習包容不同聲音，找到團隊平衡。" },
            2: { title: "協調者 (The Mediator)", desc: "您富有同理心，擅長建立情感連結，是極佳的合作夥伴。挑戰在於過度在意他人感受而失去自我立場，需學習劃定界線。" },
            3: { title: "藝術家 (The Communicator)", desc: "您充滿想像力與幽默感，擁有孩子般的純真。在藝術與創意領域極具天賦，但有時想法過於分散，需學習專注與務實行動。" },
            4: { title: "建設者 (The Builder)", desc: "您是腳踏實地的實幹家，重視規劃與結構，給人強烈的安全感。挑戰在於過度固執或內心隱藏的不安，需學習彈性變通。" },
            5: { title: "冒險家 (The Adventurer)", desc: "您天生渴望自由，適應力強，熱愛探索未知。但容易缺乏持續性，若能專注於長期目標，將能收穫更多成功。" },
            6: { title: "療癒者 (The Nurturer)", desc: "您擁有強烈的責任感與關懷心，重視家庭與承諾。需注意不要過度犧牲自己，學習「平衡對別人的愛與對自己的愛」。" },
            7: { title: "思考者 (The Analyst)", desc: "您喜歡探究真理，直覺敏銳，對於無法證明的事物抱持懷疑。適合透過獨處與冥想來發展內在深層思維。" },
            8: { title: "實踐家 (The Executive)", desc: "您對目標有極高執行力，重視豐盛與權力。天生具備商業頭腦，但需注意避免因目的性過強而忽略原則，相信自我價值。" },
            9: { title: "人道主義者 (The Humanitarian)", desc: "您擁有博愛精神與智慧，樂於奉獻。若能無私助人，往往能獲得意想不到的回報。需在夢想與現實間找到平衡。" },
            
            // --- 大師數 (Master Numbers) ---
            11: { title: "啟蒙大師 (The Illuminator)", desc: "【11/2】您擁有非凡的靈覺力與洞察力，是天生的精神領袖。直覺強烈，能連結高頻訊息。挑戰在於神經系統較敏感，需學習讓內在平靜，信任自己的直覺。" },
            22: { title: "築夢大師 (The Master Builder)", desc: "【22/4】您結合了理想主義與務實行動力，擁有將宏大夢想顯化為現實的能力。挑戰在於避免過度承擔責任，學習如何在物質世界中平衡身心。" },
            33: { title: "療癒大師 (The Master Teacher)", desc: "【33/6】您充滿無條件的愛與慈悲，是充滿智慧的靈魂導師。天生具有強大的療癒力，但也容易過度犧牲。挑戰在於先照顧好自己，才能用愛滋養世界。" }
        };

        // --- 2. 靈數對應水晶 (全面擴充) ---
        const numberCrystals = {
            1: { 
                desc: "增強領導力與行動力", 
                stones: ["紅瑪瑙", "金運石", "硃砂", "紅膠花", "鈦赫茲", "火焰石", "石榴石", "彼得石", "黑髮晶", "太陽石", "紅髮晶", "銅鈦晶", "黑膽石"] 
            },
            2: { 
                desc: "平衡情緒與自我界線", 
                stones: ["鹽源瑪瑙", "藍珀", "紫鋰輝", "紅紋石", "異極礦", "透石膏", "糖果螢石", "馬島月光", "孔雀石", "摩根石", "櫻花瑪瑙", "粉雷姆利亞", "橙月光", "藍月光", "灰月光"] 
            },
            3: { 
                desc: "激發創意與快樂", 
                stones: ["黃水晶", "鈦晶", "黃膠花", "黃方解", "黃銅礦", "黃金雲母螢石", "彼得石", "火焰石", "金髮晶", "橙月光", "托帕石"] 
            },
            4: { 
                desc: "建立安全感與彈性", 
                stones: ["水草瑪瑙", "綠草莓晶", "兔毛螢石-綠", "綠龍晶", "葡萄石", "阿拉善", "余太翠", "彩螢石", "印度沸石", "櫻花瑪瑙", "黑膽石"] 
            },
            5: { 
                desc: "穩定情緒與溝通", 
                stones: ["海藍寶", "藍紋瑪瑙", "藍玉隨", "天河石", "兔毛螢石-藍", "拉利瑪", "異極礦", "藍晶石", "青金石", "藍磷灰", "托帕石", "白松石"] 
            },
            6: { 
                desc: "療癒焦慮與關懷", 
                stones: ["草莓晶", "鹽源瑪瑙", "紫鋰輝", "紅紋石", "藥王石", "葡萄石", "舒俱萊", "薔薇輝石", "摩根石", "櫻花瑪瑙", "粉雷姆利亞"] 
            },
            7: { 
                desc: "提升直覺與深層思考", 
                stones: ["拉長石", "紫螢石", "紫龍晶", "舒俱萊", "預言石", "紫粉超七", "透石膏", "彩螢石", "氟鋁石膏", "紫鈦晶", "藍月光", "粉雷姆利亞", "巴西仙人掌紫晶"] 
            },
            8: { 
                desc: "顯化財富與抗壓", 
                stones: ["金運石", "黃水晶", "鈦晶", "方解晶鎮", "千層黃方解", "黃銅礦", "彼得石", "黑金超七", "金髮晶", "年輪魚子舍利", "黑膽石", "灰月光"] 
            },
            9: { 
                desc: "慈悲與靈性連結", 
                stones: ["白水晶", "異象軟糖爆球花晶鎮", "拉長石", "藥王石", "預言石", "透石膏", "舒俱萊", "印度沸石", "粉雷姆利亞", "巴西仙人掌紫晶", "年輪魚子舍利", "白松石"] 
            },
            // --- 大師數對應 ---
            11: {
                desc: "直覺開發與靈性平衡",
                stones: ["紫水晶", "紫螢石", "拉長石", "白水晶", "藍針白水晶", "天青石", "極光23", "巴西仙人掌紫晶"]
            },
            22: {
                desc: "夢想顯化與務實築基",
                stones: ["黑碧璽", "綠幽靈", "金運石", "黃銅礦", "黑金超七", "四季幽靈", "年輪魚子舍利"]
            },
            33: {
                desc: "無私大愛與深層療癒",
                stones: ["粉晶", "藥王石", "海藍寶", "拉利瑪", "孔雀石", "紫鋰輝", "摩根石", "粉雷姆利亞"]
            }
        };

        // --- 3. 特殊水晶組合 (更新高階款) ---
        const specialCrystals = [
            { 
                name: "黑金超七", 
                target: "all", 
                covers: [1, 2, 3, 4, 5, 6, 7, 8, 9],
                desc: "【全脈輪平衡】對應人體七大脈輪，能量極強，適合空缺數較多者，能一次補足全方位能量，提升整體運勢。" 
            },
            { 
                name: "彩超七 / 紫粉超七 / 金草莓半盆超七", 
                target: "all", 
                covers: [1, 2, 3, 4, 5, 6, 7, 8, 9],
                desc: "【高頻揚升】超七家族系列，能量全面且強大。紫粉偏人緣靈性，金草莓偏財富愛情，彩超七則全方位補給。" 
            },
            { 
                name: "金運石", 
                target: "specific", 
                covers: [1, 8], 
                desc: "【行動顯化】結合黑色的極致防護(1號)與金色的顯化力量(8號)，能幫助您將想法落地執行，並轉化為實質財富與權威。" 
            },
            { 
                name: "方解晶鎮 / 異象軟糖爆球花晶鎮", 
                target: "specific", 
                covers: [8, 9], 
                desc: "【聚財化煞】方解石具有強大的化煞與聚財功效，晶鎮型態更能鎮守財庫(8)並淨化空間磁場(9)。" 
            },
            { 
                name: "紫鈦方解石擺件", 
                target: "specific", 
                covers: [7, 8], 
                desc: "【智慧與財富】結合紫色的靈性智慧(7)與金色的財富能量(8)，適合需要運用直覺與智慧來創造財富的人。" 
            },
            { 
                name: "預言石 / 黃銅礦", 
                target: "specific", 
                covers: [7, 8, 9], 
                desc: "【靈性顯化】預言石能開啟高階視覺與靈性(7,9)，黃銅礦則能將靈性洞見顯化為物質財富(8)。" 
            },
            { 
                name: "彼得石 (Pietersite)", 
                target: "specific", 
                covers: [1, 3, 8], 
                desc: "【王者之石】暴風雨寶石，能激發勇氣(1)，開啟無限創意(3)，並帶來如暴風般的強大財運(8)。" 
            },
            { 
                name: "拉利瑪 (Larimar)", 
                target: "specific", 
                covers: [5, 6], 
                desc: "【海豚之石】對應喉輪與心輪。能療癒深層的情感創傷(6)，並帶來如海洋般平靜的溝通能量(5)。" 
            }
        ];

        // --- 4. 完整水晶數據庫 (大幅擴充) ---
        const crystalDB = [
            // 原有保留...
            { name: "粉晶", element: "火", numbers: [2, 4, 6, 9], effect: "【愛情與療癒】柔軟心房，增強愛與包容，平衡過度付出。" },
            { name: "海藍寶共生方解石", element: "水/金", numbers: [5, 7], effect: "【溝通與淨化】強力清理喉輪阻塞，幫助表達真實情感，化解深層恐懼。" },
            { name: "阿魯沙", element: "火", numbers: [1, 3], effect: "【正向與療癒】擁有太陽石的正面能量與綠柱石的療癒力，驅散負面。" },
            { name: "極光23", element: "全元素", numbers: [1,2,3,4,5,6,7,8,9], effect: "【靈性覺醒】最古老水晶，含23種礦物。對應全脈輪，強力修復身心靈，提升靈性感知。" },
            { name: "青金石", element: "水/木", numbers: [5, 7], effect: "【真理與洞察】對應眉心輪/喉輪。能平穩心態，增強洞察力，幫助看清真相與表達自我。" },
            { name: "四季幽靈", element: "土/木", numbers: [4, 8], effect: "【願景與財富】對應心輪。內含四季景色，象徵圓滿。能穩固事業，招攬正財，落實夢想。" },
            { name: "紫鈦晶", element: "火/金", numbers: [7, 8], effect: "【靈性之財】紫水晶與鈦晶共生。結合智慧與財富，適合需要運用直覺做決策的領導者。" },
            { name: "茶晶/煙晶", element: "土/水", numbers: [4, 8], effect: "【穩重與過濾】對應海底輪。能過濾濁氣與病氣，使人情緒平穩，落實想法，增強行動持續力。" },
            { name: "彩碧璽", element: "全元素", numbers: [2,3,4,5,6], effect: "【能量平衡】電氣石，能暢通血氣。玫瑰碧璽旺人緣，綠碧璽招正財，黃碧璽招富貴。" },
            { name: "黑曜石", element: "水", numbers: [1, 8], effect: "【避邪檔煞】對應海底輪。強力吸收負能量，排除病氣，防小人，是最好的護身符。" },
            { name: "金曜石", element: "金/水", numbers: [1, 8], effect: "【招財黑武士】黑曜石中帶金沙。除了避邪，更增強了招財與行動力，適合職場男性。" },
            { name: "銀曜石", element: "水", numbers: [4, 7], effect: "【專注與驅魔】光澤如銀，能增強注意力與專注力，驅除心魔與執著，帶來平靜。" },
            { name: "彩虹曜石", element: "水", numbers: [6, 9], effect: "【希望與療癒】黑底中透出彩虹光。能撫平情緒創傷，帶來希望與轉化的力量，溫柔的守護石。" },
            { name: "閃靈", element: "光", numbers: [9], effect: "【淨化與夢境】雙尖水晶，能量通透。能淨化氣場，提升睡眠品質，增強夢境的清晰度。" },
            { name: "白阿賽斯特萊", element: "光", numbers: [7, 9], effect: "【宇宙之光】極高頻率，無需淨化。能協助大腦與高維度意識連結，清理全身脈輪阻塞。" },
            { name: "黃阿賽斯特萊", element: "金/火", numbers: [3, 8], effect: "【顯化之光】對應太陽輪。能將高頻能量注入物質實相，加速願望顯化，增強意志力與財運。" },
            { name: "龍宮舍利", element: "土/光", numbers: [9], effect: "【正氣磁場】產自泰國龍宮洞。具有強大正磁場，能調整身體氣場，避邪擋煞，安定心神。" },
            { name: "財寶舍利", element: "土/金", numbers: [8], effect: "【聚氣招財】龍宮舍利的一種。專注於聚集財氣與福報，適合需要提升事業運與財運的人。" },
            { name: "馬島月光", element: "水", numbers: [2, 6], effect: "【溫柔直覺】產自馬達加斯加。光澤更強，能提升直覺力，平撫焦慮，帶來溫柔的守護能量。" },
            { name: "月光石", element: "水", numbers: [2, 6], effect: "【戀人之石】對應頂輪/心輪。能平伏煩躁心情，潤滑感情，提升女性魅力與睡眠品質。" },
            { name: "彩兔毛", element: "火/土", numbers: [1, 3], effect: "【活力與自信】包含紅、黃、白等髮晶。能增強海底輪能量，提升氣色、活力與自信心。" },
            { name: "紅虎眼石", element: "火", numbers: [1], effect: "【熱情與行動】增強爆發力與熱情，克服膽怯，適合需要大量體力與行動力的人。" },
            { name: "黃虎眼石", element: "土/金", numbers: [3, 8], effect: "【勇氣與財富】貓眼效應強。能激發勇氣，堅定信念，帶來財富與事業上的突破。" },
            { name: "藍虎眼石", element: "水", numbers: [5], effect: "【冷靜與洞悉】能平復激動情緒，增強洞悉力與判斷力，看清事物本質。" },
            { name: "三色虎眼石", element: "全元素", numbers: [1, 3, 5, 8], effect: "【全方位護佑】集合紅、黃、藍虎眼功效。能平衡能量，帶來勇氣、財富與冷靜的判斷力。" },
            { name: "天青石", element: "水/風", numbers: [5, 7], effect: "【天使之石】對應喉輪/頂輪。能量極其平和，能連結天使能量，帶來深層寧靜與清晰溝通。" },
            { name: "粉澳寶", element: "火/水", numbers: [2, 6], effect: "【天使肌膚】對應心輪。溫柔的粉色能量，能療癒情感創傷，散發柔和魅力，招來好人緣。" },
            { name: "藍晶石", element: "水", numbers: [5, 7], effect: "【協調與表達】絕佳的協調石。能自動平衡脈輪，不累積負能量。助於表達真實自我，化解溝通障礙。" },
            { name: "紫水晶", element: "火/水", numbers: [1, 7, 9], effect: "【智慧與貴人】對應頂輪。能融洽人際連結，釋放掌控欲(1)，提升靈性意識(7)，並擴大慈愛影響力(9)。" },
            { name: "紫晶鎮", element: "火/土", numbers: [7, 9], effect: "【鎮宅與聚氣】紫晶鎮如同小型能量發電站，能穩定空間磁場，提升靈性智慧(7)，並凝聚貴人運與正氣(9)。" },
            { name: "藍針白水晶", element: "水/光", numbers: [5, 7, 9], effect: "【天使羽毛】白水晶中隱含藍色羽毛狀包裹體。能同時淨化(9)並開啟喉輪(5)與眉心輪(7)，帶來平靜與高維度的指引。" },
            { name: "天鐵", element: "金", numbers: [1, 8, 9], effect: "【宇宙能量】來自外太空的隕石，能量極強大。能打通七脈輪，增強行動力(1)，招財避邪(8)，並提升靈性連結(9)。" },
            { name: "氟鋁石膏", element: "光/風", numbers: [7, 9], effect: "【高頻淨化】非常稀有的高頻礦石，能快速清理氣場，提升靈性頻率，幫助冥想與連結高我(7, 9)。" },
            { name: "孔雀石", element: "木/土", numbers: [2, 4, 6], effect: "【轉化與保護】對應心輪。能吸收負能量與幅射，釋放情緒創傷(2, 6)，帶來轉化的力量與保護(4)。" },
            { name: "堇青石", element: "水", numbers: [7], effect: "【指引之石】對應眉心輪。能幫助看清真相，提升直覺與洞察力(7)，並有助於戒除成癮習慣，找回人生方向。" },
            { name: "黑髮晶", element: "水", numbers: [1, 8], effect: "【領袖與避邪】黑髮晶包含黑色電氣石，能量強勁。能消除負能量，增強領袖魅力(1)，避邪擋煞並招偏財(8)。" },
            { name: "太陽石", element: "火", numbers: [1, 3], effect: "【活力與領導】對應太陽神經叢。帶來如太陽般的正面能量，驅散憂鬱(3)，增強領袖魅力與自信(1)。" },
            { name: "薔薇輝石", element: "火/土", numbers: [6, 9], effect: "【救贖之石】對應心輪。修復情感創傷，調和親密關係(6)，協助展現無私的愛(9)，從失戀或家庭問題中走出。" },
            { name: "魚眼石", element: "水/靈", numbers: [7, 9], effect: "【靈性之眼】高含水量的靈性寶石。能打通眉心輪(7)與頂輪(9)，提升直覺與靈視力，幫助放鬆與冥想。" },
            { name: "紅兔毛", element: "火", numbers: [1, 3], effect: "【青春活力】紅色網狀金紅石，對應海底輪。能增強活力、自信與氣色(1)，調整女性生理機能，帶來如青春般的熱情(3)。" },
            { name: "黃螢石", element: "土/金", numbers: [3, 8], effect: "【創意與合作】對應太陽輪。能提升創造力與直覺(3)，增強團體合作與人際溝通，幫助招財(8)。" },
            { name: "綠螢石", element: "木", numbers: [4], effect: "【情緒穩定】對應心輪。能平穩情緒，吸收負能量，帶來身心的穩定與平衡(4)，幫助思緒清晰。" },
            { name: "糖果螢石", element: "全元素", numbers: [2, 6], effect: "【繽紛療癒】多色共生，色彩柔和如糖果。能療癒內在小孩，帶來愉悅心情與親和力(2, 6)。" },
            { name: "羽毛螢石 (紫綠/紫藍綠)", element: "風/靈", numbers: [7, 9], effect: "【靈性羽翼】紫綠/紫藍綠色系。擁有如羽毛般美麗紋路。能清理氣場負擔，提升靈性能量(7)，連結高維度智慧(9)。" },
            { name: "水膽水晶", element: "水/土", numbers: [5, 8], effect: "【流動與財富】水晶中包覆千萬年前的純水。象徵財源滾滾(8)，能增強適應力與靈活度(5)，緩解壓力。" },
            { name: "金髮晶", element: "金/火", numbers: [3, 8], effect: "【吉祥富貴】被稱為「維納斯之髮」。能增強自信與決斷力(3)，招攬正財與偏財(8)，氣場強大。" },
            { name: "銅鈦晶", element: "火/金", numbers: [1, 8], effect: "【領袖氣場】含有銅金色的髮絲，能量剛勁。能提升膽識與衝勁(1)，增強領導魅力，並具有強大的辟邪招財功效(8)。" },
            { name: "紅髮晶", element: "火", numbers: [1, 3], effect: "【青春活力】對應海底輪。能增強生命力與熱情(1)，調整氣色，增進自信與個人魅力(3)，適合女性佩戴。" },
            { name: "印度沸石", element: "土", numbers: [4, 9], effect: "【強力吸負】被譽為吸毒石。能強力吸附空間與氣場中的負能量、病氣與晦氣，是極佳的風水淨化石。" },
            
            // --- 本次新增 (黑膽石、年輪魚子舍利、托帕石、粉雷姆利亞、摩根石、櫻花瑪瑙、藍磷灰、白松石、巴西仙人掌紫晶、月光石家族) ---
            { name: "黑膽石 (Hematite)", element: "土/水", numbers: [1, 4, 8], effect: "【接地與健康】對應海底輪。能增強體力，促進血液循環，幫助接地氣，消除恐懼，使思緒清晰。" },
            { name: "年輪魚子舍利", element: "土/金", numbers: [8, 9], effect: "【聚福與化煞】稀有舍利礦。具有強大的正能量磁場，能化解煞氣(9)，聚集福氣與財氣(8)，護身保平安。" },
            { name: "托帕石 (Topaz)", element: "水/金", numbers: [3, 5], effect: "【友誼與溝通】又稱黃玉。藍色托帕石助溝通(5)，黃色/帝王托帕石招財與自信(3)。象徵和平與友誼。" },
            { name: "粉雷姆利亞 (Pink Lemurian)", element: "光/火", numbers: [2, 6, 7, 9], effect: "【古文明智慧】來自雷姆利亞文明的連結。粉色光能療癒心輪(2,6)，條碼紋路儲存遠古智慧，助靈性開啟(7,9)。" },
            { name: "摩根石 (Morganite)", element: "火", numbers: [2, 6], effect: "【神聖之愛】粉色綠柱石，對應心輪。能帶來溫和而強大的愛之能量，療癒深層情感，改善人際關係(2,6)。" },
            { name: "櫻花瑪瑙 (Cherry Blossom Agate)", element: "木/火", numbers: [2, 4, 6], effect: "【綻放與溫柔】瑪瑙中飄舞著如櫻花般的內含物。象徵希望與成長(4)，能溫柔地療癒內在，提升女性魅力(2,6)。" },
            { name: "藍磷灰 (Blue Apatite)", element: "水", numbers: [5], effect: "【知性與表達】對應喉輪。能激發靈感，增強表達能力(5)，對於需要大量溝通或學習的人非常有幫助。" },
            { name: "白松石 (White Turquoise/Howlite)", element: "土/水", numbers: [5, 9], effect: "【平靜與安眠】對應頂輪。能平撫憤怒與焦慮，帶來深層平靜，改善睡眠品質(9)，亦助於冷靜溝通(5)。" },
            { name: "巴西仙人掌紫晶 (Cactus Amethyst)", element: "火/光", numbers: [7, 9], effect: "【集體意識】精靈水晶的一種。無數小晶尖覆蓋在主晶體上，象徵團結與和諧(9)，能量細緻高頻，助冥想(7)。" },
            { name: "橙月光 (Orange Moonstone)", element: "水/土", numbers: [2, 3], effect: "【溫暖與情緒】對應臍輪。能平穩情緒波動(2)，帶來溫暖的安全感，緩解焦慮，激發創造力(3)。" },
            { name: "藍月光 (Blue Moonstone)", element: "水", numbers: [2, 7], effect: "【直覺與神祕】最高等級的月光石。散發藍色暈彩，能增強直覺與靈通力(7)，連結陰性女神能量，極具守護力(2)。" },
            { name: "灰月光 (Grey Moonstone)", element: "水", numbers: [2, 8], effect: "【洞察與保護】又稱拉長石月光。能幫助看清真相，保護氣場不被干擾(2)，適合在複雜環境中工作的人(8)。" },
            { name: "黑碧璽 (Black Tourmaline)", element: "水", numbers: [2, 4, 8], effect: "【強力防護】對應海底輪。能形成強大的能量保護罩(2)，釋放壓力維持身心穩定(4)，轉化負能量為正向動力(8)。" },
            
            // --- 本次大量新增 (數十種礦石) ---
            { name: "白水晶 (White Crystal)", element: "金/光", numbers: [9], effect: "【淨化之王】對應頂輪。能淨化所有負能量，提升專注力與記憶力，平衡身心靈。" },
            { name: "黃水晶 (Citrine)", element: "土/金", numbers: [3, 8], effect: "【財富之石】對應太陽輪。主聚財，能消除恐懼，帶來自信與快樂。" },
            { name: "鈦晶 (Titanium Quartz)", element: "金/火", numbers: [3, 8], effect: "【能量之王】對應太陽輪。能量霸道，招正偏財，增強氣場與決斷力。" },
            { name: "碧璽 (Tourmaline)", element: "全元素", numbers: [2,3,4,5,6], effect: "【願望寶石】落入人間的彩虹，能平衡各脈輪，暢通血氣，招財旺夫。" },
            { name: "紅瑪瑙 (Agate)", element: "火", numbers: [1], effect: "【正向與熱情】對應海底輪。消除壓力與疲勞，增強行動力與勇氣。" },
            { name: "藍紋瑪瑙", element: "水", numbers: [5], effect: "【平靜與溝通】對應喉輪。平復焦躁情緒，幫助順暢表達與冷靜思考。" },
            { name: "水草瑪瑙", element: "木/水", numbers: [4], effect: "【生機與靈活】如水中水草般靈動。能增強適應力，帶來生機與事業發展。" },
            { name: "鹽源瑪瑙", element: "火/土", numbers: [2, 6], effect: "【療癒與人緣】色彩豐富如糖果。能療癒驚嚇，舒緩緊張，增進人緣與親和力。" },
            { name: "藍玉隨", element: "水", numbers: [5], effect: "【避邪與護身】對應喉輪。古老的護身符，能阻擋負能量，防小人，助溝通。" },
            { name: "方解晶鎮 / 軟糖花晶鎮", element: "土/金", numbers: [8, 9], effect: "【化煞聚財】方解石能化解家中煞氣，晶鎮型態更能鎮守財庫，淨化磁場。" },
            { name: "海藍寶 (Aquamarine)", element: "水", numbers: [5], effect: "【勇氣之石】對應喉輪。加強表達能力與領悟力，平撫急躁，適合溝通者。" },
            { name: "紅膠花 / 黃膠花", element: "火/土", numbers: [1, 3, 8], effect: "【貴人與開運】水晶內的異象。紅膠花招貴人開運(1)，黃膠花招偏財(3,8)。" },
            { name: "草莓晶 / 綠草莓晶", element: "火/木", numbers: [6, 4], effect: "【愛與和諧】紅草莓主愛情與人際(6)，綠草莓主事業與和諧(4)。" },
            { name: "超七系列 (黑金/紫粉/彩/金草莓)", element: "全元素", numbers: [1,2,3,4,5,6,7,8,9], effect: "【全能揚升】含七種礦物共生。能量極強，全方位補給，提升靈性與運勢。" },
            { name: "天河石 (Amazonite)", element: "水", numbers: [5], effect: "【希望之石】對應喉輪。帶來幸運與貴人，幫助順暢溝通，重燃信心。" },
            { name: "拉長石 (Labradorite)", element: "水", numbers: [7, 9], effect: "【靈魂行者】對應頂輪。開闊僵化思維，提升直覺與洞察力，連結高我。" },
            { name: "黃方解 / 千層黃方解", element: "土/金", numbers: [3, 8], effect: "【繁榮與財富】黃色對應太陽輪。能招財聚氣，消除自我懷疑，帶來繁榮。" },
            { name: "紫鈦方解石", element: "火/金", numbers: [7, 8], effect: "【靈性與財富】稀有共生礦。結合智慧與財富能量，提升靈性財商。" },
            { name: "兔毛螢石 (綠/藍)", element: "木/水", numbers: [4, 5], effect: "【穩定與流動】綠色穩定情緒(4)，藍色助溝通流動(5)，絲狀內含物增強能量導引。" },
            { name: "彩螢石", element: "全元素", numbers: [4, 7], effect: "【智慧之石】去除雜念，提升專注力與創意，幫助思緒清晰。" },
            { name: "黃金雲母瑩石", element: "土/金", numbers: [3, 8], effect: "【閃耀與招財】螢石共生雲母。帶來如黃金般的閃耀財氣，提升自信與魅力。" },
            { name: "紫螢石", element: "水", numbers: [7], effect: "【靈性與專注】對應眉心輪。提升直覺，排除腦部疲勞，適合靈修與用腦過度者。" },
            { name: "金運石", element: "金", numbers: [1, 8], effect: "【極致招財】黑底金線。強力避邪擋煞(1)，招財效果極佳(8)，適合職場與博弈。" },
            { name: "綠龍晶", element: "木", numbers: [4], effect: "【天使之翼】對應心輪。消除孤獨與挫折感，帶來溫暖與療癒，助事業發展。" },
            { name: "藍珀", element: "木/水", numbers: [2, 5], effect: "【安神與定氣】有機寶石。能安神定氣，改善睡眠，幫助情緒穩定與溝通。" },
            { name: "紫鋰輝", element: "火", numbers: [2, 6], effect: "【無私的愛】對應心輪。能暢通七脈輪，消除壓力，帶來無私與喜悅的愛。" },
            { name: "石榴石", element: "火", numbers: [1], effect: "【女人之石】對應海底輪。促進血液循環，增強體力與生命力，美容養顏。" },
            { name: "舒俱萊", element: "火/水", numbers: [6, 7, 9], effect: "【治癒之石】對應眉心輪。能清除深層負能量，提升免疫力，開啟靈性智慧。" },
            { name: "藥王石", element: "土", numbers: [6, 9], effect: "【健康守護】對應心輪。釋放深層焦慮與壓力，磁場溫和強大，守護身心健康。" },
            { name: "鈦赫茲", element: "金", numbers: [1], effect: "【生命之光】高頻震動波。能促進血液循環，增強活力與行動力，消除疲勞。" },
            { name: "異極礦", element: "水", numbers: [2, 5], effect: "【轉化與提升】對應喉輪。能轉化負面情緒，帶來樂觀與喜悅，助溝通。" },
            { name: "透石膏", element: "光", numbers: [7, 9], effect: "【淨化之光】無需淨化的高頻石。能快速清理氣場與空間，連結天使能量。" },
            { name: "葡萄石", element: "木", numbers: [4, 6], effect: "【希望之石】淡淡綠色。能指引方向(4)，療癒內心創傷，舒緩緊張壓力(6)。" },
            { name: "紅紋石", element: "火", numbers: [2, 6], effect: "【愛神之石】對應心輪。能療癒失戀痛苦，招來美好姻緣，讓愛再次流動。" },
            { name: "紫龍晶", element: "火/水", numbers: [7], effect: "【慈悲與智慧】對應頂輪。能消除孤獨與恐懼，帶來慈悲與智慧，助靈性成長。" },
            { name: "彼得石", element: "水/金", numbers: [1, 3, 8], effect: "【暴風雨寶石】王者之石。能激發勇氣(1)，開啟創意(3)，帶來強大財運(8)。" },
            { name: "拉利瑪", element: "水", numbers: [5], effect: "【海豚之石】對應喉輪。能療癒深層情感，像海洋般平靜情緒，助順暢溝通。" },
            { name: "預言石", element: "土", numbers: [7, 9], effect: "【預知與落地】能開啟頂輪與海底輪。幫助連結高維度訊息，並將其落實於生活。" },
            { name: "黃銅礦", element: "金", numbers: [3, 8], effect: "【顯化財富】金色礦石。能增強自信，將靈性洞見顯化為物質財富。" },
            { name: "硃砂", element: "火", numbers: [1], effect: "【避邪鎮煞】陽氣極重。能避邪擋煞，安神定魂，增強生命力與行動力。" },
            { name: "阿拉善", element: "土", numbers: [4], effect: "【大地之石】來自戈壁。能量厚實，能帶來踏實感，招財守財，保平安。" },
            { name: "火焰石 (Yooperlite)", element: "火", numbers: [1, 3], effect: "【能量爆發】紫外線下發光。能點燃內心火焰，增強自信與表達力，釋放恐懼。" },
            { name: "余太翠", element: "木", numbers: [4], effect: "【溫潤養人】中國玉石。能養心安神，帶來吉祥與平安，穩定情緒。" }
        ];

        const linesDef = [
            { nums: [1, 2, 3], name: "藝術線", benefit: "擁有美學與創意的能量，能自在表達自我。" },
            { nums: [4, 5, 6], name: "組織線", benefit: "做事有條理，能完美執行計畫與解決問題。" },
            { nums: [7, 8, 9], name: "權力線", benefit: "擁有強大氣場與貴人運，容易獲得社會成就。" },
            { nums: [1, 4, 7], name: "務實線", benefit: "腳踏實地，對金錢與物質生活有極佳的掌控力。" },
            { nums: [2, 5, 8], name: "感情線", benefit: "善於溝通與表達情感，擁有極佳的人緣魅力。" },
            { nums: [3, 6, 9], name: "智慧線", benefit: "充滿靈性智慧，直覺敏銳，能洞察事物本質。" },
            { nums: [1, 5, 9], name: "事業線", benefit: "擁有強烈企圖心與工作狂特質，事業發展無可限量。" },
            { nums: [3, 5, 7], name: "人緣線", benefit: "極具個人魅力，受人歡迎，容易成為群體焦點。" }
        ];

        const flowMonthData = {
            1: { keyword: "播種期", desc: "採取行動的最佳時機。適合「紅瑪瑙」或「金運石」，增強開創勇氣。" },
            2: { keyword: "蟄伏期", desc: "適合細膩溝通。推薦「藍珀」或「紫鋰輝」，讓情緒保持柔和穩定。" },
            3: { keyword: "萌芽期", desc: "社交能量活躍。適合「黃水晶」或「鈦晶」，展現光芒，多參加聚會。" },
            4: { keyword: "紮根期", desc: "專注與務實。推薦「水草瑪瑙」或「阿拉善」，釋放壓力並鞏固成果。" },
            5: { keyword: "變化期", desc: "意想不到的機會。適合「海藍寶」或「天河石」，保持順暢溝通。" },
            6: { keyword: "關懷期", desc: "回歸情感與愛。推薦「草莓晶」或「紅紋石」，療癒關係，化解隔閡。" },
            7: { keyword: "省思期", desc: "適合獨處進修。推薦「紫龍晶」或「拉長石」，提升內在智慧。" },
            8: { keyword: "收穫期", desc: "成果顯化。適合「方解晶鎮」或「彼得石」，承接豐盛能量，肯定自我價值。" },
            9: { keyword: "完結期", desc: "清理與放下。推薦「透石膏」或「白水晶」，淨化並迎接新循環。" }
        };

        const dailyQuotes = {
            1: "【流日1】今天的能量適合「開始」。別讓猶豫阻擋你的腳步，相信直覺，勇敢為自己踏出第一步。",
            2: "【流日2】今天的能量柔軟而細膩。若感到情緒波動，請給自己一個擁抱，溫柔其實是種強大的力量。",
            3: "【流日3】今天的能量充滿創意與孩子氣。別把話悶在心裡，試著表達真實的感受，快樂會隨之而來。",
            4: "【流日4】今天的能量需要「穩定」。即使外在環境變動，請記得你的內心依然可以像大樹一樣扎根安穩。",
            5: "【流日5】今天的能量自由奔放。若計畫趕不上變化，不如享受這場冒險，驚喜往往藏在未知的轉彎處。",
            6: "【流日6】今天的能量充滿愛與責任。在照顧別人的同時，別忘了留一杯茶的時間給自己，你也很重要。",
            7: "【流日7】今天的能量適合沉澱。遠離喧囂，給大腦一點空白，你尋找的答案往往會在靜心中浮現。",
            8: "【流日8】今天的能量豐盛強大。請相信自己的價值，你有能力顯化心中渴望的富足與成就。",
            9: "【流日9】今天的能量適合「清理」。放下那些不再服務於你的情緒與舊物，騰出空間，迎接新的美好。"
        };

        // --- 邏輯函數 ---
        function sumDigits(num) {
            let sum = 0;
            const digits = num.toString().split('');
            for (let digit of digits) sum += parseInt(digit);
            while (sum > 9) {
                let tempSum = 0;
                const tempDigits = sum.toString().split('');
                for (let d of tempDigits) tempSum += parseInt(d);
                sum = tempSum;
            }
            return sum;
        }

        function calculateLifePath(y, m, d) {
            let sum = 0;
            const dateStr = `${y}${m}${d}`;
            for(let char of dateStr) sum += parseInt(char);
            
            // Check for Master Numbers first
            if (sum === 11 || sum === 22 || sum === 33) {
                return sum;
            }
            
            return sumDigits(sum);
        }

        function checkPotentialLines(existingNums, missingNum) {
            const potentialLines = [];
            const hypotheticalSet = new Set([...existingNums, missingNum]);
            linesDef.forEach(line => {
                const hadLineOriginally = line.nums.every(n => existingNums.has(n));
                const hasLineNow = line.nums.every(n => hypotheticalSet.has(n));
                if (!hadLineOriginally && hasLineNow) {
                    potentialLines.push(line);
                }
            });
            return potentialLines;
        }
        
        function getSpecialRecommendations(missingArr) {
            let recs = [];
            const missingSet = new Set(missingArr);
            
            // 1. Logic for "All-rounders" (High missing count)
            if (missingArr.length >= 3) {
                // Find items with target 'all'
                const allRounders = specialCrystals.filter(c => c.target === 'all');
                recs.push(...allRounders);
            }
            
            // 2. Logic for "Specific Efficiency" (Covers >= 2 missing numbers)
            specialCrystals.forEach(crystal => {
                if (crystal.target === 'specific') {
                    let matchCount = 0;
                    crystal.covers.forEach(n => {
                        if (missingSet.has(n)) matchCount++;
                    });
                    
                    if (matchCount >= 2) {
                        // Prevent duplicates if already added by 'all' logic (though 'all' usually covers distinct items)
                        if (!recs.includes(crystal)) {
                            recs.push(crystal);
                        }
                    }
                }
            });
            
            // 3. Randomize and Limit to 6
            // Fisher-Yates Shuffle
            for (let i = recs.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [recs[i], recs[j]] = [recs[j], recs[i]];
            }
            
            return recs.slice(0, 6);
        }

        function calculate() {
            const y = parseInt(document.getElementById('birthYear').value);
            const m = parseInt(document.getElementById('birthMonth').value);
            const d = parseInt(document.getElementById('birthDay').value);

            if (!y || !m || !d) {
                alert("請完整選擇出生年、月、日");
                return;
            }

            // 1. Life Path
            const lp = calculateLifePath(y, m, d);
            document.getElementById('lifePathNum').innerText = lp;
            document.getElementById('lifePathTitle').innerText = lifePathData[lp].title;
            document.getElementById('lifePathDesc').innerText = lifePathData[lp].desc;
            
            // Master Number Logic
            const masterTag = document.getElementById('masterTag');
            if (lp === 11 || lp === 22 || lp === 33) {
                masterTag.classList.remove('hidden');
            } else {
                masterTag.classList.add('hidden');
            }

            // 2. Missing Numbers
            const dateStr = y.toString() + m.toString().padStart(2, '0') + d.toString().padStart(2, '0');
            const presentSet = new Set();
            for (let char of dateStr) {
                const num = parseInt(char);
                if (num !== 0) presentSet.add(num);
            }
            const missing = [];
            for (let i = 1; i <= 9; i++) {
                if (!presentSet.has(i)) missing.push(i);
            }

            const missingContainer = document.getElementById('missingContainer');
            const specialSection = document.getElementById('specialSection');
            const specialContainer = document.getElementById('specialContainer');
            missingContainer.innerHTML = '';
            specialContainer.innerHTML = '';

            if (missing.length === 0) {
                document.getElementById('noMissing').classList.remove('hidden');
                document.getElementById('missingContainer').classList.add('hidden');
                specialSection.classList.add('hidden');
            } else {
                document.getElementById('noMissing').classList.add('hidden');
                document.getElementById('missingContainer').classList.remove('hidden');
                
                const specialRecs = getSpecialRecommendations(missing);
                if (specialRecs.length > 0) {
                    specialSection.classList.remove('hidden');
                    specialRecs.forEach(spec => {
                         const div = document.createElement('div');
                         div.className = 'bg-[#3d3124] border border-[#967740]/30 p-4 rounded-xl';
                         const coverTags = spec.covers
                            .filter(n => missing.includes(n))
                            .map(n => `<span class="text-xs bg-[#bca065] text-[#2c241b] px-1.5 py-0.5 rounded font-bold mr-1">缺${n}</span>`)
                            .join('');
                         div.innerHTML = `
                            <div class="flex justify-between items-start mb-2">
                                <h5 class="text-[#eaddcf] font-bold text-lg">${spec.name}</h5>
                            </div>
                            <div class="mb-2">${coverTags}</div>
                            <p class="text-xs text-[#bca065]/90 leading-relaxed">${spec.desc}</p>
                         `;
                         specialContainer.appendChild(div);
                    });
                } else {
                    specialSection.classList.add('hidden');
                }

                missing.forEach(num => {
                    const data = numberCrystals[num];
                    const newLines = checkPotentialLines(presentSet, num);
                    let lineHtml = '';
                    if (newLines.length > 0) {
                        const lineContent = newLines.map(l => 
                            `<div class="mt-3 text-xs text-gray-600 pl-3 border-l-2 border-gold bg-gold/5 p-2 rounded-r-md">
                                <span class="font-bold text-gold block mb-1">★ 啟動${l.name} (${l.nums.join('-')})</span>
                                ${l.benefit}
                             </div>`
                        ).join('');
                        lineHtml = lineContent;
                    }
                    const stonesHtml = data.stones.map(s => `<span class="tag-pill">${s}</span>`).join('');
                    const div = document.createElement('div');
                    div.className = 'bg-white rounded-2xl p-5 border border-gray-100 shadow-sm hover:shadow-md transition-shadow h-full flex flex-col justify-between';
                    div.innerHTML = `
                        <div>
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full bg-[#967740] text-white flex items-center justify-center font-bold text-lg font-serif shadow-md shrink-0">
                                        ${num}
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-gray-700">缺少 ${num} 號能量</h4>
                                        <p class="text-xs text-gray-400">${data.desc}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="flex flex-wrap gap-1">${stonesHtml}</div>
                            </div>
                        </div>
                        ${lineHtml ? `<div>${lineHtml}</div>` : ''}
                    `;
                    missingContainer.appendChild(div);
                });
            }

            // 3. Flow Month & Day
            const today = new Date();
            const currentYear = today.getFullYear();
            const currentMonth = today.getMonth() + 1;
            const currentDay = today.getDate();
            let referenceYear = currentYear;
            const birthdayThisYear = new Date(currentYear, m - 1, d);
            if (today < birthdayThisYear) referenceYear = currentYear - 1;

            let fySum = 0;
            const refStr = referenceYear.toString() + m.toString() + d.toString();
            for(let char of refStr) fySum += parseInt(char);
            const flowYear = sumDigits(fySum);
            const flowMonth = sumDigits(flowYear + currentMonth);
            const flowDay = sumDigits(flowMonth + currentDay);

            document.getElementById('currentDateDisplay').innerText = `${today.getFullYear()}.${currentMonth.toString().padStart(2,'0')}.${currentDay.toString().padStart(2,'0')}`;
            document.getElementById('flowMonthNum').innerText = flowMonth;
            
            // Adjust flowMonth to 1-9 range for display data lookup
            let displayFlowMonth = flowMonth;
            while(displayFlowMonth > 9) {
                 displayFlowMonth = sumDigits(displayFlowMonth);
            }
            
            const flowInfo = flowMonthData[displayFlowMonth];
            const recStones = numberCrystals[displayFlowMonth].stones.slice(0, 4);
            document.getElementById('flowCrystal').innerHTML = recStones.map(s => `<span class="tag-pill border-gold/30 text-gold-dark bg-white">${s}</span>`).join('');
            document.getElementById('flowDesc').innerText = `【${flowInfo.keyword}】${flowInfo.desc}`;
            
            // Flow Day
            let displayFlowDay = flowDay;
            while(displayFlowDay > 9) {
                displayFlowDay = sumDigits(displayFlowDay);
            }
            document.getElementById('flowDayNum').innerText = displayFlowDay;
            document.getElementById('dailyQuoteText').innerText = dailyQuotes[displayFlowDay];

            document.getElementById('resultSection').classList.remove('hidden');
            document.getElementById('resultSection').classList.add('flex');
            setTimeout(() => {
                document.getElementById('resultSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function resetApp() {
            // Reset dropdowns
            document.getElementById('birthYear').selectedIndex = 0;
            document.getElementById('birthMonth').selectedIndex = 0;
            document.getElementById('birthDay').innerHTML = '<option value="" disabled selected>日 Day</option>'; // Clear days
            
            // Hide result section
            document.getElementById('resultSection').classList.add('hidden');
            document.getElementById('resultSection').classList.remove('flex');
            
            // Clear Crystal Search if needed
            document.getElementById('crystalSearchInput').value = '';
            document.getElementById('crystalSearchResult').classList.add('hidden');
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // --- Crystal Search Function ---
        function searchCrystal() {
            const input = document.getElementById('crystalSearchInput').value.toLowerCase();
            const resultContainer = document.getElementById('crystalSearchResult');
            resultContainer.innerHTML = '';
            
            if (!input) {
                resultContainer.classList.add('hidden');
                return;
            }
            const matches = crystalDB.filter(c => c.name.toLowerCase().includes(input));
            if (matches.length > 0) {
                resultContainer.classList.remove('hidden');
                matches.forEach(item => {
                    const numTags = item.numbers.map(n => `<span class="inline-block w-6 h-6 rounded-full bg-[#967740] text-white text-xs text-center leading-6 mr-1">${n}</span>`).join('');
                    const div = document.createElement('div');
                    div.className = 'bg-white p-4 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-2';
                    div.innerHTML = `
                        <div class="flex justify-between items-center border-b border-gray-100 pb-2">
                            <h4 class="font-bold text-lg text-gray-800">${item.name}</h4>
                            <span class="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded">${item.element}</span>
                        </div>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="text-xs text-gray-400">對應靈數:</span>
                            <div>${numTags}</div>
                        </div>
                        <p class="text-sm text-gray-600 leading-relaxed">${item.effect}</p>
                    `;
                    resultContainer.appendChild(div);
                });
            } else {
                resultContainer.classList.remove('hidden');
                resultContainer.innerHTML = `<div class="text-center text-gray-400 text-sm py-4">找不到相關水晶，請嘗試其他名稱</div>`;
            }
        }
    </script>
</body>
</html>
